"use strict";(self.webpackChunk_react_babylonjs_docs=self.webpackChunk_react_babylonjs_docs||[]).push([[636],{60246:function(e,t,r){r.d(t,{a:function(){return i},x:function(){return $}});var i,n=r(56666),a=r(9249),s=r(87371),o=r(80753),h=r(45754),l=r(11987),u=r(95058),c=r(49341),d=r(18322),v=r(12508),f=r(79179),g=r(19802),m=r(60859),y=r(84562),_=r(35267),b=r(85873),p=r(91603),M=r(48765),C=r(483),k=r(86009),R=r(26466),O=r(75847),A=r(2307),S=r(38962),w=r(8374),T=r(90865),B=r(85055),I=r(54593),D=r(54612),P=r(89181),x=r(27874),N=r(40634),E=r(72209);function F(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,u.Z)(e);if(t){var n=(0,u.Z)(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return(0,l.Z)(this,r)}}!function(e){e[e.BackwardCompatible=0]="BackwardCompatible",e[e.Intermediate=1]="Intermediate",e[e.Aggressive=2]="Aggressive"}(i||(i={}));var $=function(e){(0,h.Z)(r,e);var t=q(r);function r(e,s){var h;(0,a.Z)(this,r),(h=t.call(this))._inputManager=new T.$((0,o.Z)(h)),h.cameraToUseForPointers=null,h._isScene=!0,h._blockEntityCollection=!1,h.autoClear=!0,h.autoClearDepthAndStencil=!0,h.clearColor=new I.HE(.2,.2,.3,1),h.ambientColor=new I.Wo(0,0,0),h.environmentIntensity=1,h._performancePriority=i.BackwardCompatible,h._forceWireframe=!1,h._skipFrustumClipping=!1,h._forcePointsCloud=!1,h.animationsEnabled=!0,h._animationPropertiesOverride=null,h.useConstantAnimationDeltaTime=!1,h.constantlyUpdateMeshUnderPointer=!1,h.hoverCursor="pointer",h.defaultCursor="",h.doNotHandleCursors=!1,h.preventDefaultOnPointerDown=!0,h.preventDefaultOnPointerUp=!0,h.metadata=null,h.reservedDataStore=null,h.disableOfflineSupportExceptionRules=new Array,h.onDisposeObservable=new v.y$,h._onDisposeObserver=null,h.onBeforeRenderObservable=new v.y$,h._onBeforeRenderObserver=null,h.onAfterRenderObservable=new v.y$,h.onAfterRenderCameraObservable=new v.y$,h._onAfterRenderObserver=null,h.onBeforeAnimationsObservable=new v.y$,h.onAfterAnimationsObservable=new v.y$,h.onBeforeDrawPhaseObservable=new v.y$,h.onAfterDrawPhaseObservable=new v.y$,h.onReadyObservable=new v.y$,h.onBeforeCameraRenderObservable=new v.y$,h._onBeforeCameraRenderObserver=null,h.onAfterCameraRenderObservable=new v.y$,h._onAfterCameraRenderObserver=null,h.onBeforeActiveMeshesEvaluationObservable=new v.y$,h.onAfterActiveMeshesEvaluationObservable=new v.y$,h.onBeforeParticlesRenderingObservable=new v.y$,h.onAfterParticlesRenderingObservable=new v.y$,h.onDataLoadedObservable=new v.y$,h.onNewCameraAddedObservable=new v.y$,h.onCameraRemovedObservable=new v.y$,h.onNewLightAddedObservable=new v.y$,h.onLightRemovedObservable=new v.y$,h.onNewGeometryAddedObservable=new v.y$,h.onGeometryRemovedObservable=new v.y$,h.onNewTransformNodeAddedObservable=new v.y$,h.onTransformNodeRemovedObservable=new v.y$,h.onNewMeshAddedObservable=new v.y$,h.onMeshRemovedObservable=new v.y$,h.onNewSkeletonAddedObservable=new v.y$,h.onSkeletonRemovedObservable=new v.y$,h.onNewMaterialAddedObservable=new v.y$,h.onNewMultiMaterialAddedObservable=new v.y$,h.onMaterialRemovedObservable=new v.y$,h.onMultiMaterialRemovedObservable=new v.y$,h.onNewTextureAddedObservable=new v.y$,h.onTextureRemovedObservable=new v.y$,h.onBeforeRenderTargetsRenderObservable=new v.y$,h.onAfterRenderTargetsRenderObservable=new v.y$,h.onBeforeStepObservable=new v.y$,h.onAfterStepObservable=new v.y$,h.onActiveCameraChanged=new v.y$,h.onActiveCamerasChanged=new v.y$,h.onBeforeRenderingGroupObservable=new v.y$,h.onAfterRenderingGroupObservable=new v.y$,h.onMeshImportedObservable=new v.y$,h.onAnimationFileImportedObservable=new v.y$,h._registeredForLateAnimationBindings=new f.f(256),h.skipPointerMovePicking=!1,h.skipPointerDownPicking=!1,h.skipPointerUpPicking=!1,h.onPrePointerObservable=new v.y$,h.onPointerObservable=new v.y$,h.onPreKeyboardObservable=new v.y$,h.onKeyboardObservable=new v.y$,h._useRightHandedSystem=!1,h._timeAccumulator=0,h._currentStepId=0,h._currentInternalStep=0,h._fogEnabled=!0,h._fogMode=r.FOGMODE_NONE,h.fogColor=new I.Wo(.2,.2,.3),h.fogDensity=.1,h.fogStart=0,h.fogEnd=1e3,h.needsPreviousWorldMatrices=!1,h._shadowsEnabled=!0,h._lightsEnabled=!0,h._unObserveActiveCameras=null,h._texturesEnabled=!0,h.physicsEnabled=!0,h.particlesEnabled=!0,h.spritesEnabled=!0,h._skeletonsEnabled=!0,h.lensFlaresEnabled=!0,h.collisionsEnabled=!0,h.gravity=new y.P(0,-9.807,0),h.postProcessesEnabled=!0,h.renderTargetsEnabled=!0,h.dumpNextRenderTargets=!1,h.customRenderTargets=new Array,h.importedMeshesFiles=new Array,h.probesEnabled=!0,h._meshesForIntersections=new f.f(256),h.proceduralTexturesEnabled=!0,h._totalVertices=new B.z,h._activeIndices=new B.z,h._activeParticles=new B.z,h._activeBones=new B.z,h._animationTime=0,h.animationTimeScale=1,h._renderId=0,h._frameId=0,h._executeWhenReadyTimeoutId=null,h._intermediateRendering=!1,h._defaultFrameBufferCleared=!1,h._viewUpdateFlag=-1,h._projectionUpdateFlag=-1,h._toBeDisposed=new Array(256),h._activeRequests=new Array,h._pendingData=new Array,h._isDisposed=!1,h.dispatchAllSubMeshesOfActiveMeshes=!1,h._activeMeshes=new f.t(256),h._processedMaterials=new f.t(256),h._renderTargets=new f.f(256),h._materialsRenderTargets=new f.f(256),h._activeParticleSystems=new f.t(256),h._activeSkeletons=new f.f(32),h._softwareSkinnedMeshes=new f.f(32),h._activeAnimatables=new Array,h._transformMatrix=y.y3.Zero(),h.requireLightSorting=!1,h._components=[],h._serializableComponents=[],h._transientComponents=[],h._beforeCameraUpdateStage=O.H.Create(),h._beforeClearStage=O.H.Create(),h._beforeRenderTargetClearStage=O.H.Create(),h._gatherRenderTargetsStage=O.H.Create(),h._gatherActiveCameraRenderTargetsStage=O.H.Create(),h._isReadyForMeshStage=O.H.Create(),h._beforeEvaluateActiveMeshStage=O.H.Create(),h._evaluateSubMeshStage=O.H.Create(),h._preActiveMeshStage=O.H.Create(),h._cameraDrawRenderTargetStage=O.H.Create(),h._beforeCameraDrawStage=O.H.Create(),h._beforeRenderTargetDrawStage=O.H.Create(),h._beforeRenderingGroupDrawStage=O.H.Create(),h._beforeRenderingMeshStage=O.H.Create(),h._afterRenderingMeshStage=O.H.Create(),h._afterRenderingGroupDrawStage=O.H.Create(),h._afterCameraDrawStage=O.H.Create(),h._afterCameraPostProcessStage=O.H.Create(),h._afterRenderTargetDrawStage=O.H.Create(),h._afterRenderTargetPostProcessStage=O.H.Create(),h._afterRenderStage=O.H.Create(),h._pointerMoveStage=O.H.Create(),h._pointerDownStage=O.H.Create(),h._pointerUpStage=O.H.Create(),h._geometriesByUniqueId=null,h._defaultMeshCandidates={data:[],length:0},h._defaultSubMeshCandidates={data:[],length:0},h._preventFreeActiveMeshesAndRenderingGroups=!1,h._activeMeshesFrozen=!1,h._activeMeshesFrozenButKeepClipping=!1,h._skipEvaluateActiveMeshesCompletely=!1,h._allowPostProcessClearColor=!0,h.getDeterministicFrameTime=function(){return h._engine.getTimeStep()},h._registeredActions=0,h._blockMaterialDirtyMechanism=!1,h._perfCollector=null,h.activeCameras=new Array;var l=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},s);return h._engine=e||S.l.LastCreatedEngine,l.virtual?h._engine._virtualScenes.push((0,o.Z)(h)):(S.l._LastCreatedScene=(0,o.Z)(h),h._engine.scenes.push((0,o.Z)(h))),h._uid=null,h._renderingManager=new R.$((0,o.Z)(h)),k.O&&(h.postProcessManager=new k.O((0,o.Z)(h))),(0,A.CG)()&&h.attachControl(),h._createUbo(),b.$&&(h._imageProcessingConfiguration=new b.$),h.setDefaultCandidateProviders(),l.useGeometryUniqueIdsMap&&(h._geometriesByUniqueId={}),h.useMaterialMeshMap=l.useMaterialMeshMap,h.useClonedMeshMap=l.useClonedMeshMap,s&&s.virtual||h._engine.onNewSceneAddedObservable.notifyObservers((0,o.Z)(h)),h}return(0,s.Z)(r,[{key:"environmentTexture",get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))}},{key:"imageProcessingConfiguration",get:function(){return this._imageProcessingConfiguration}},{key:"performancePriority",get:function(){return this._performancePriority},set:function(e){if(e!==this._performancePriority)switch(this._performancePriority=e,e){case i.BackwardCompatible:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case i.Intermediate:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case i.Aggressive:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1}}},{key:"forceWireframe",get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))}},{key:"skipFrustumClipping",get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)}},{key:"forcePointsCloud",get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))}},{key:"animationPropertiesOverride",get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e}},{key:"onDispose",set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}},{key:"beforeRender",set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))}},{key:"afterRender",set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))}},{key:"beforeCameraRender",set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)}},{key:"afterCameraRender",set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)}},{key:"unTranslatedPointer",get:function(){return this._inputManager.unTranslatedPointer}},{key:"bindEyePosition",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:null!==(t=this.activeCamera.globalPosition)&&void 0!==t?t:this.activeCamera.devicePosition,a=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return y.jp.Vector4[0].set(n.x,n.y,n.z,a?-1:1),e&&(i?e.setFloat3(r,y.jp.Vector4[0].x,y.jp.Vector4[0].y,y.jp.Vector4[0].z):e.setVector4(r,y.jp.Vector4[0])),y.jp.Vector4[0]}},{key:"finalizeSceneUbo",value:function(){var e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e}},{key:"useRightHandedSystem",get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))}},{key:"setStepId",value:function(e){this._currentStepId=e}},{key:"getStepId",value:function(){return this._currentStepId}},{key:"getInternalStep",value:function(){return this._currentInternalStep}},{key:"fogEnabled",get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))}},{key:"fogMode",get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))}},{key:"prePass",get:function(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}},{key:"shadowsEnabled",get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))}},{key:"lightsEnabled",get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))}},{key:"activeCameras",get:function(){return this._activeCameras},set:function(e){var t=this;this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),e&&(this._unObserveActiveCameras=(0,E.M)(e,(function(){t.onActiveCamerasChanged.notifyObservers(t)}))),this._activeCameras=e}},{key:"activeCamera",get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))}},{key:"defaultMaterial",get:function(){return this._defaultMaterial||(this._defaultMaterial=r.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e}},{key:"texturesEnabled",get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))}},{key:"skeletonsEnabled",get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))}},{key:"collisionCoordinator",get:function(){return this._collisionCoordinator||(this._collisionCoordinator=r.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}},{key:"renderingManager",get:function(){return this._renderingManager}},{key:"frustumPlanes",get:function(){return this._frustumPlanes}},{key:"_registerTransientComponents",value:function(){if(this._transientComponents.length>0){var e,t=F(this._transientComponents);try{for(t.s();!(e=t.n()).done;){e.value.register()}}catch(r){t.e(r)}finally{t.f()}this._transientComponents.length=0}}},{key:"_addComponent",value:function(e){this._components.push(e),this._transientComponents.push(e);var t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)}},{key:"_getComponent",value:function(e){var t,r=F(this._components);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.name===e)return i}}catch(n){r.e(n)}finally{r.f()}return null}},{key:"getClassName",value:function(){return"Scene"}},{key:"_getDefaultMeshCandidates",value:function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}},{key:"_getDefaultSubMeshCandidates",value:function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates}},{key:"setDefaultCandidateProviders",value:function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)}},{key:"meshUnderPointer",get:function(){return this._inputManager.meshUnderPointer}},{key:"pointerX",get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e}},{key:"pointerY",get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e}},{key:"getCachedMaterial",value:function(){return this._cachedMaterial}},{key:"getCachedEffect",value:function(){return this._cachedEffect}},{key:"getCachedVisibility",value:function(){return this._cachedVisibility}},{key:"isCachedMaterialInvalid",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==r}},{key:"getEngine",value:function(){return this._engine}},{key:"getTotalVertices",value:function(){return this._totalVertices.current}},{key:"totalVerticesPerfCounter",get:function(){return this._totalVertices}},{key:"getActiveIndices",value:function(){return this._activeIndices.current}},{key:"totalActiveIndicesPerfCounter",get:function(){return this._activeIndices}},{key:"getActiveParticles",value:function(){return this._activeParticles.current}},{key:"activeParticlesPerfCounter",get:function(){return this._activeParticles}},{key:"getActiveBones",value:function(){return this._activeBones.current}},{key:"activeBonesPerfCounter",get:function(){return this._activeBones}},{key:"getActiveMeshes",value:function(){return this._activeMeshes}},{key:"getAnimationRatio",value:function(){return void 0!==this._animationRatio?this._animationRatio:1}},{key:"getRenderId",value:function(){return this._renderId}},{key:"getFrameId",value:function(){return this._frameId}},{key:"incrementRenderId",value:function(){this._renderId++}},{key:"_createUbo",value:function(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}},{key:"simulatePointerMove",value:function(e,t){return this._inputManager.simulatePointerMove(e,t),this}},{key:"simulatePointerDown",value:function(e,t){return this._inputManager.simulatePointerDown(e,t),this}},{key:"simulatePointerUp",value:function(e,t,r){return this._inputManager.simulatePointerUp(e,t,r),this}},{key:"isPointerCaptured",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(e)}},{key:"attachControl",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(e,t,r)}},{key:"detachControl",value:function(){this._inputManager.detachControl()}},{key:"isReady",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;var r=this.getEngine(),i=!0;for(this._pendingData.length>0&&(i=!1),t&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),e=0;e<this.meshes.length;e++){var n=this.meshes[e];if(n.subMeshes&&0!==n.subMeshes.length)if(n.isReady(!0)){var a,s=n.hasThinInstances||"InstancedMesh"===n.getClassName()||"InstancedLinesMesh"===n.getClassName()||r.getCaps().instancedArrays&&n.instances.length>0,o=F(this._isReadyForMeshStage);try{for(o.s();!(a=o.n()).done;){var h=a.value;h.action(n,s)||(i=!1)}}catch(C){o.e(C)}finally{o.f()}if(t){var l=n.material||this.defaultMaterial;if(l)if(l._storeEffectOnSubMeshes){var u,c=F(n.subMeshes);try{for(c.s();!(u=c.n()).done;){var d=u.value,v=d.getMaterial();v&&v.hasRenderTargetTextures&&null!=v.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(v)&&(this._processedMaterials.push(v),this._materialsRenderTargets.concatWithNoDuplicate(v.getRenderTargetTextures()))}}catch(C){c.e(C)}finally{c.f()}}else l.hasRenderTargetTextures&&null!=l.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(l)&&(this._processedMaterials.push(l),this._materialsRenderTargets.concatWithNoDuplicate(l.getRenderTargetTextures()))}}else i=!1}if(!i)return!1;if(!r.areAllEffectsReady())return!1;if(t)for(e=0;e<this._materialsRenderTargets.length;++e){var f=this._materialsRenderTargets.data[e];if(!f.isReadyForRendering())return!1}for(e=0;e<this.geometries.length;e++){var g=this.geometries[e];if(2===g.delayLoadState)return!1}if(this.activeCameras&&this.activeCameras.length>0){var m,y=F(this.activeCameras);try{for(y.s();!(m=y.n()).done;){var _=m.value;if(!_.isReady(!0))return!1}}catch(C){y.e(C)}finally{y.f()}}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;var b,p=F(this.particleSystems);try{for(p.s();!(b=p.n()).done;){var M=b.value;if(!M.isReady())return!1}}catch(C){p.e(C)}finally{p.f()}return!0}},{key:"resetCachedMaterial",value:function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}},{key:"registerBeforeRender",value:function(e){this.onBeforeRenderObservable.add(e)}},{key:"unregisterBeforeRender",value:function(e){this.onBeforeRenderObservable.removeCallback(e)}},{key:"registerAfterRender",value:function(e){this.onAfterRenderObservable.add(e)}},{key:"unregisterAfterRender",value:function(e){this.onAfterRenderObservable.removeCallback(e)}},{key:"_executeOnceBeforeRender",value:function(e){var t=this;this.registerBeforeRender((function r(){e(),setTimeout((function(){t.unregisterBeforeRender(r)}))}))}},{key:"executeOnceBeforeRender",value:function(e,t){var r=this;void 0!==t?setTimeout((function(){r._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)}},{key:"addPendingData",value:function(e){this._pendingData.push(e)}},{key:"removePendingData",value:function(e){var t=this.isLoading,r=this._pendingData.indexOf(e);-1!==r&&this._pendingData.splice(r,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}},{key:"getWaitingItemsCount",value:function(){return this._pendingData.length}},{key:"isLoading",get:function(){return this._pendingData.length>0}},{key:"executeWhenReady",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(e),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)}},{key:"whenReadyAsync",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(r){e.executeWhenReady((function(){r()}),t)}))}},{key:"_checkIsReady",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(t)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((function(){e.incrementRenderId(),e._checkIsReady(t)}),100))}},{key:"animatables",get:function(){return this._activeAnimatables}},{key:"resetLastAnimationTimeFrame",value:function(){this._animationTimeLast=d.F.Now}},{key:"getViewMatrix",value:function(){return this._viewMatrix}},{key:"getProjectionMatrix",value:function(){return this._projectionMatrix}},{key:"getTransformMatrix",value:function(){return this._transformMatrix}},{key:"setTransformMatrix",value:function(e,t,r,i){r||i||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?D.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=D.i.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(r,i):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}},{key:"getSceneUniformBuffer",value:function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}},{key:"createSceneUniformBuffer",value:function(e){var t=new p.M(this._engine,void 0,!1,null!=e?e:"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t}},{key:"setSceneUniformBuffer",value:function(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}},{key:"getUniqueId",value:function(){return P.K.UniqueId}},{key:"addMesh",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),r&&e.getChildMeshes().forEach((function(e){t.addMesh(e)})))}},{key:"removeMesh",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.meshes.indexOf(e);return-1!==i&&(this.meshes[i]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),r&&e.getChildMeshes().forEach((function(e){t.removeMesh(e)})),i}},{key:"addTransformNode",value:function(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneTransformNodesArray||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))}},{key:"removeTransformNode",value:function(e){var t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){var r=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=r,r._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t}},{key:"removeSkeleton",value:function(e){var t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t}},{key:"removeMorphTargetManager",value:function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t}},{key:"removeLight",value:function(e){var t=this.lights.indexOf(e);if(-1!==t){var r,i=F(this.meshes);try{for(i.s();!(r=i.n()).done;){r.value._removeLightSource(e,!1)}}catch(n){i.e(n)}finally{i.f()}this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t}},{key:"removeCamera",value:function(e){var t=this.cameras.indexOf(e);if(-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){var r=this.activeCameras.indexOf(e);-1!==r&&this.activeCameras.splice(r,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t}},{key:"removeParticleSystem",value:function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t}},{key:"removeAnimation",value:function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t}},{key:"stopAnimation",value:function(e,t,r){}},{key:"removeAnimationGroup",value:function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t}},{key:"removeMultiMaterial",value:function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t}},{key:"removeMaterial",value:function(e){var t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){var r=this.materials[this.materials.length-1];this.materials[t]=r,r._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t}},{key:"removeActionManager",value:function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t}},{key:"removeTexture",value:function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t}},{key:"addLight",value:function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();var t,r=F(this.meshes);try{for(r.s();!(t=r.n()).done;){var i=t.value;-1===i.lightSources.indexOf(e)&&(i.lightSources.push(e),i._resyncLightSources())}}catch(n){r.e(n)}finally{r.f()}this.onNewLightAddedObservable.notifyObservers(e)}}},{key:"sortLightsByPriority",value:function(){this.requireLightSorting&&this.lights.sort(N.m.CompareLightsPriority)}},{key:"addCamera",value:function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())}},{key:"addSkeleton",value:function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))}},{key:"addParticleSystem",value:function(e){this._blockEntityCollection||this.particleSystems.push(e)}},{key:"addAnimation",value:function(e){this._blockEntityCollection||this.animations.push(e)}},{key:"addAnimationGroup",value:function(e){this._blockEntityCollection||this.animationGroups.push(e)}},{key:"addMultiMaterial",value:function(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))}},{key:"addMaterial",value:function(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneMaterialArray||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))}},{key:"addMorphTargetManager",value:function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)}},{key:"addGeometry",value:function(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))}},{key:"addActionManager",value:function(e){this.actionManagers.push(e)}},{key:"addTexture",value:function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))}},{key:"switchActiveCamera",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._engine.getInputElement();r&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())}},{key:"setActiveCameraById",value:function(e){var t=this.getCameraById(e);return t?(this.activeCamera=t,t):null}},{key:"setActiveCameraByName",value:function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null}},{key:"getAnimationGroupByName",value:function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null}},{key:"_getMaterial",value:function(e,t){for(var r=0;r<this.materials.length;r++){var i=this.materials[r];if(t(i))return i}if(e)for(var n=0;n<this.multiMaterials.length;n++){var a=this.multiMaterials[n];if(t(a))return a}return null}},{key:"getMaterialByUniqueID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(t,(function(t){return t.uniqueId===e}))}},{key:"getMaterialById",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(t,(function(t){return t.id===e}))}},{key:"getMaterialByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(t,(function(t){return t.name===e}))}},{key:"getLastMaterialById",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.materials.length-1;r>=0;r--)if(this.materials[r].id===e)return this.materials[r];if(t)for(var i=this.multiMaterials.length-1;i>=0;i--)if(this.multiMaterials[i].id===e)return this.multiMaterials[i];return null}},{key:"getTextureByUniqueId",value:function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null}},{key:"getTextureByName",value:function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null}},{key:"getCameraById",value:function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null}},{key:"getCameraByUniqueId",value:function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null}},{key:"getCameraByName",value:function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null}},{key:"getBoneById",value:function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],i=0;i<r.bones.length;i++)if(r.bones[i].id===e)return r.bones[i];return null}},{key:"getBoneByName",value:function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],i=0;i<r.bones.length;i++)if(r.bones[i].name===e)return r.bones[i];return null}},{key:"getLightByName",value:function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null}},{key:"getLightById",value:function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null}},{key:"getLightByUniqueId",value:function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null}},{key:"getParticleSystemById",value:function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null}},{key:"getGeometryById",value:function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null}},{key:"_getGeometryByUniqueId",value:function(e){if(this._geometriesByUniqueId){var t=this._geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(var r=0;r<this.geometries.length;r++)if(this.geometries[r].uniqueId===e)return this.geometries[r];return null}},{key:"pushGeometry",value:function(e,t){return!(!t&&this._getGeometryByUniqueId(e.uniqueId))&&(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)}},{key:"removeGeometry",value:function(e){var t;if(this._geometriesByUniqueId){if(void 0===(t=this._geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;if(t!==this.geometries.length-1){var r=this.geometries[this.geometries.length-1];r&&(this.geometries[t]=r,this._geometriesByUniqueId&&(this._geometriesByUniqueId[r.uniqueId]=t))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0}},{key:"getGeometries",value:function(){return this.geometries}},{key:"getMeshById",value:function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null}},{key:"getMeshesById",value:function(e){return this.meshes.filter((function(t){return t.id===e}))}},{key:"getTransformNodeById",value:function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null}},{key:"getTransformNodeByUniqueId",value:function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null}},{key:"getTransformNodesById",value:function(e){return this.transformNodes.filter((function(t){return t.id===e}))}},{key:"getMeshByUniqueId",value:function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null}},{key:"getLastMeshById",value:function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null}},{key:"getLastEntryById",value:function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null}},{key:"getNodeById",value:function(e){var t=this.getMeshById(e);if(t)return t;var r=this.getTransformNodeById(e);if(r)return r;var i=this.getLightById(e);if(i)return i;var n=this.getCameraById(e);if(n)return n;var a=this.getBoneById(e);return a||null}},{key:"getNodeByName",value:function(e){var t=this.getMeshByName(e);if(t)return t;var r=this.getTransformNodeByName(e);if(r)return r;var i=this.getLightByName(e);if(i)return i;var n=this.getCameraByName(e);if(n)return n;var a=this.getBoneByName(e);return a||null}},{key:"getMeshByName",value:function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null}},{key:"getTransformNodeByName",value:function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null}},{key:"getLastSkeletonById",value:function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null}},{key:"getSkeletonByUniqueId",value:function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null}},{key:"getSkeletonById",value:function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null}},{key:"getSkeletonByName",value:function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null}},{key:"getMorphTargetManagerById",value:function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null}},{key:"getMorphTargetById",value:function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var r=this.morphTargetManagers[t],i=0;i<r.numTargets;++i){var n=r.getTarget(i);if(n.id===e)return n}return null}},{key:"getMorphTargetByName",value:function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var r=this.morphTargetManagers[t],i=0;i<r.numTargets;++i){var n=r.getTarget(i);if(n.name===e)return n}return null}},{key:"getPostProcessByName",value:function(e){for(var t=0;t<this.postProcesses.length;++t){var r=this.postProcesses[t];if(r.name===e)return r}return null}},{key:"isActiveMesh",value:function(e){return-1!==this._activeMeshes.indexOf(e)}},{key:"uid",get:function(){return this._uid||(this._uid=c.w1.RandomId()),this._uid}},{key:"addExternalData",value:function(e,t){return this._externalData||(this._externalData=new g.x),this._externalData.add(e,t)}},{key:"getExternalData",value:function(e){return this._externalData?this._externalData.get(e):null}},{key:"getOrAddExternalDataWithFactory",value:function(e,t){return this._externalData||(this._externalData=new g.x),this._externalData.getOrAddWithFactory(e,t)}},{key:"removeExternalData",value:function(e){return this._externalData.remove(e)}},{key:"_evaluateSubMesh",value:function(e,t,r,i){if(i||e.isInFrustum(this._frustumPlanes)){var n,a=F(this._evaluateSubMeshStage);try{for(a.s();!(n=a.n()).done;){n.value.action(t,e)}}catch(o){a.e(o)}finally{a.f()}var s=e.getMaterial();null!=s&&(s.hasRenderTargetTextures&&null!=s.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(s)&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,s))}}},{key:"freeProcessedMaterials",value:function(){this._processedMaterials.dispose()}},{key:"blockfreeActiveMeshesAndRenderingGroups",get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)}},{key:"freeActiveMeshes",value:function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}}},{key:"freeRenderingGroups",value:function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}}},{key:"_isInIntermediateRendering",value:function(){return this._intermediateRendering}},{key:"freezeActiveMeshes",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((function(){if(e.activeCamera){if(e._frustumPlanes||e.updateTransformMatrix(),e._evaluateActiveMeshes(),e._activeMeshesFrozen=!0,e._activeMeshesFrozenButKeepClipping=a,e._skipEvaluateActiveMeshesCompletely=t,n)for(var s=0;s<e._activeMeshes.length;s++)e._activeMeshes.data[s]._freeze();r&&r()}else i&&i("No active camera found")})),this}},{key:"unfreezeActiveMeshes",value:function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(var r=0;r<this._activeMeshes.length;r++)this._activeMeshes.data[r]._unFreeze();return this._activeMeshesFrozen=!1,this}},{key:"_executeActiveContainerCleanup",value:function(e){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((function(){return e.dispose()}))}},{key:"_evaluateActiveMeshes",value:function(){var e;if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)this._activeMeshes.length>0&&(null===(e=this.activeCamera)||void 0===e||e._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());else if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var t=this._activeMeshes.length,r=0;r<t;r++){this._activeMeshes.data[r].computeWorldMatrix()}if(this._activeParticleSystems)for(var i=this._activeParticleSystems.length,n=0;n<i;n++)this._activeParticleSystems.data[n].animate();this._renderingManager.resetSprites()}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();var a,s=F(this._beforeEvaluateActiveMeshStage);try{for(s.s();!(a=s.n()).done;){a.value.action()}}catch(y){s.e(y)}finally{s.f()}for(var o=this.getActiveMeshCandidates(),h=o.length,l=0;l<h;l++){var u=o.data[l];if(u._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!u.isBlocked&&(this._totalVertices.addCount(u.getTotalVertices(),!1),u.isReady()&&u.isEnabled()&&!u.scaling.hasAZeroComponent)){u.computeWorldMatrix(),u.actionManager&&u.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(u);var c=this.customLODSelector?this.customLODSelector(u,this.activeCamera):u.getLOD(this.activeCamera);if(u._internalAbstractMeshDataInfo._currentLOD=c,u._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,null!=c&&(c!==u&&0!==c.billboardMode&&c.computeWorldMatrix(),u._preActivate(),u.isVisible&&u.visibility>0&&0!=(u.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||u.alwaysSelectAsActiveMesh||u.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(u),this.activeCamera._activeMeshes.push(u),c!==u&&c._activate(this._renderId,!1);var d,v=F(this._preActiveMeshStage);try{for(v.s();!(d=v.n()).done;){d.value.action(u)}}catch(y){v.e(y)}finally{v.f()}u._activate(this._renderId,!1)&&(u.isAnInstance?u._internalAbstractMeshDataInfo._actAsRegularMesh&&(c=u):c._internalAbstractMeshDataInfo._onlyForInstances=!1,c._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(u,c)),u._postActivate()}}}if(this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var f=0;f<this.particleSystems.length;f++){var g=this.particleSystems[f];if(g.isStarted()&&g.emitter){var m=g.emitter;m.position&&!m.isEnabled()||(this._activeParticleSystems.push(g),g.animate(),this._renderingManager.dispatchParticles(g))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}}},{key:"_activeMesh",value:function(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));var r=e.hasInstances||e.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh;if(t&&t.subMeshes&&t.subMeshes.length>0){var i=this.getActiveSubMeshCandidates(t),n=i.length;r=r||1===n;for(var a=0;a<n;a++){var s=i.data[a];this._evaluateSubMesh(s,t,e,r)}}}},{key:"updateTransformMatrix",value:function(e){if(this.activeCamera)if(this.activeCamera._renderingMultiview){var t=this.activeCamera._rigCameras[0],r=this.activeCamera._rigCameras[1];this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e),r.getViewMatrix(),r.getProjectionMatrix(e))}else this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))}},{key:"_bindFrameBuffer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(e)}},{key:"_clearFrameBuffer",value:function(e){if(e&&e._multiviewTexture);else if(e&&e.outputRenderTarget&&!e._renderingMultiview){var t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):t.skipInitialClear||(this.autoClear&&this._engine.clear(t.clearColor||this.clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}},{key:"_renderForCamera",value:function(e,t){var r,i,n,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e||!e._skipRendering){var s=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(s.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&a){var o=!0;e._renderingMultiview&&e.outputRenderTarget&&(o=e.outputRenderTarget.skipInitialClear,this.autoClear&&(e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=o)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var h=0;h<this._softwareSkinnedMeshes.length;h++){var l=this._softwareSkinnedMeshes.data[h];l.applySkeleton(l.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);var u,d=F(this._gatherActiveCameraRenderTargetsStage);try{for(d.s();!(u=d.n()).done;){var v=u.value;v.action(this._renderTargets)}}catch(I){d.e(I)}finally{d.f()}var f=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){c.w1.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var g=0;g<this._renderTargets.length;g++){var m=this._renderTargets.data[g];if(m._shouldRender()){this._renderId++;var y=m.activeCamera&&m.activeCamera!==this.activeCamera;m.render(y,this.dumpNextRenderTargets),f=!0}}c.w1.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}var _,b=F(this._cameraDrawRenderTargetStage);try{for(b.s();!(_=b.n()).done;){var p=_.value;f=p.action(this.activeCamera)||f}}catch(I){b.e(I)}finally{b.f()}this._intermediateRendering=!1}this._engine.currentRenderPassId=null!==(n=null!==(i=null===(r=e.outputRenderTarget)||void 0===r?void 0:r.renderPassId)&&void 0!==i?i:e.renderPassId)&&void 0!==n?n:0,f&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||e._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();var M,C=F(this._beforeCameraDrawStage);try{for(C.s();!(M=C.n()).done;){var k=M.value;k.action(this.activeCamera)}}catch(I){C.e(I)}finally{C.f()}this.onBeforeDrawPhaseObservable.notifyObservers(this),s.snapshotRendering&&1===s.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);var R,O=F(this._afterCameraDrawStage);try{for(O.s();!(R=O.n()).done;){var A=R.value;A.action(this.activeCamera)}}catch(I){O.e(I)}finally{O.f()}if(this.postProcessManager&&!e._multiviewTexture){var S=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,S)}var w,T=F(this._afterCameraPostProcessStage);try{for(T.s();!(w=T.n()).done;){var B=w.value;B.action(this.activeCamera)}}catch(I){T.e(I)}finally{T.f()}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}}},{key:"_processSubCameras",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===e.cameraRigMode||e._renderingMultiview)return e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(var r=0;r<e._rigCameras.length;r++)this._renderForCamera(e._rigCameras[r],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)}},{key:"_checkIntersections",value:function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var r=function(){var e=t.actionManager.actions[i];if(12===e.trigger||13===e.trigger){var r=e.getTriggerParameter(),n=r.mesh?r.mesh:r,a=n.intersectsMesh(t,r.usePreciseIntersection),s=t._intersectionsInProgress.indexOf(n);a&&-1===s?12===e.trigger?(e._executeCurrent(C.V.CreateNew(t,void 0,n)),t._intersectionsInProgress.push(n)):13===e.trigger&&t._intersectionsInProgress.push(n):!a&&s>-1&&(13===e.trigger&&e._executeCurrent(C.V.CreateNew(t,void 0,n)),t.actionManager.hasSpecificTrigger(13,(function(e){var t=e.mesh?e.mesh:e;return n===t}))&&13!==e.trigger||t._intersectionsInProgress.splice(s,1))}},i=0;t.actionManager&&i<t.actionManager.actions.length;i++)r()}}},{key:"_advancePhysicsEngineStep",value:function(e){}},{key:"_animate",value:function(){}},{key:"animate",value:function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(r.MinDeltaTime,Math.min(this._engine.getDeltaTime(),r.MaxDeltaTime))+this._timeAccumulator,t=this._engine.getTimeStep(),i=1e3/t/1e3,n=0,a=this._engine.getLockstepMaxSteps(),s=Math.floor(e/t);for(s=Math.min(s,a);e>0&&n<s;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*i,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,n++,e-=t;this._timeAccumulator=e<0?0:e}else{var o=this.useConstantAnimationDeltaTime?16:Math.max(r.MinDeltaTime,Math.min(this._engine.getDeltaTime(),r.MaxDeltaTime));this._animationRatio=.06*o,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(o)}}},{key:"_clear",value:function(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}},{key:"_checkCameraRenderTarget",value:function(e){var t;if((null==e?void 0:e.outputRenderTarget)&&!(null==e?void 0:e.isRigCamera)&&(e.outputRenderTarget._cleared=!1),null===(t=null==e?void 0:e.rigCameras)||void 0===t?void 0:t.length)for(var r=0;r<e.rigCameras.length;++r){var i=e.rigCameras[r].outputRenderTarget;i&&(i._cleared=!1)}}},{key:"resetDrawCache",value:function(e){if(this.meshes){var t,r=F(this.meshes);try{for(r.s();!(t=r.n()).done;){t.value.resetDrawCache(e)}}catch(i){r.e(i)}finally{r.f()}}}},{key:"render",value:function(){var e,t,r,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isDisposed){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),(null===(e=this.activeCameras)||void 0===e?void 0:e.length)&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),n||this.animate();var a,s=F(this._beforeCameraUpdateStage);try{for(s.s();!(a=s.n()).done;){var o=a.value;o.action()}}catch(T){s.e(T)}finally{s.f()}if(i)if(this.activeCameras&&this.activeCameras.length>0)for(var h=0;h<this.activeCameras.length;h++){var l=this.activeCameras[h];if(l.update(),0!==l.cameraRigMode)for(var u=0;u<l._rigCameras.length;u++)l._rigCameras[u].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(var d=0;d<this.activeCamera._rigCameras.length;d++)this.activeCamera._rigCameras[d].update();this.onBeforeRenderObservable.notifyObservers(this);var v=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var f=(null===(t=this.activeCameras)||void 0===t?void 0:t.length)?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){c.w1.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var g=0;g<this.customRenderTargets.length;g++){var m=this.customRenderTargets[g];if(m._shouldRender()){if(this._renderId++,this.activeCamera=m.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");v.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),m.render(f!==this.activeCamera,this.dumpNextRenderTargets)}}c.w1.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=null!==(r=null==f?void 0:f.renderPassId)&&void 0!==r?r:0,this.activeCamera=f,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);var y,_=F(this._beforeClearStage);try{for(_.s();!(y=_.n()).done;){var b=y.value;b.action()}}catch(T){_.e(T)}finally{_.f()}this._clearFrameBuffer(this.activeCamera);var p,M=F(this._gatherRenderTargetsStage);try{for(M.s();!(p=M.n()).done;){var C=p.value;C.action(this._renderTargets)}}catch(T){M.e(T)}finally{M.f()}if(this.activeCameras&&this.activeCameras.length>0)for(var k=0;k<this.activeCameras.length;k++)this._processSubCameras(this.activeCameras[k],k>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();var R,O=F(this._afterRenderStage);try{for(O.s();!(R=O.n()).done;){var A=R.value;A.action()}}catch(T){O.e(T)}finally{O.f()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(var S=0;S<this._toBeDisposed.length;S++){var w=this._toBeDisposed[S];w&&w.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}},{key:"freezeMaterials",value:function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()}},{key:"unfreezeMaterials",value:function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()}},{key:"dispose",value:function(){if(!this.isDisposed){this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;var e,t=F(this._activeRequests.slice());try{for(t.s();!(e=t.n()).done;){e.value.abort()}}catch(a){t.e(a)}finally{t.f()}this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(s){console.error("An error occurred while calling onDisposeObservable!",s)}if(this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl(),this._engine.getInputElement())for(var r=0;r<this.cameras.length;r++)this.cameras[r].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(function(e){return e.dispose(!0)})),this._disposeList(this.transformNodes,(function(e){return e.dispose(!0)}));var i=this.cameras;this._disposeList(i),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);var n=this._engine.scenes.indexOf(this);n>-1&&this._engine.scenes.splice(n,1),S.l._LastCreatedScene===this&&(this._engine.scenes.length>0?S.l._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:S.l._LastCreatedScene=null),(n=this._engine._virtualScenes.indexOf(this))>-1&&this._engine._virtualScenes.splice(n,1),this._engine.wipeCaches(!0),this._isDisposed=!0}}},{key:"_disposeList",value:function(e,t){t=null!=t?t:function(e){return e.dispose()};var r,i=F(e.slice(0));try{for(i.s();!(r=i.n()).done;){t(r.value)}}catch(n){i.e(n)}finally{i.f()}e.length=0}},{key:"isDisposed",get:function(){return this._isDisposed}},{key:"clearCachedVertexData",value:function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;t&&t.clearCachedData()}}},{key:"cleanCachedTextureBuffer",value:function(){var e,t=F(this.textures);try{for(t.s();!(e=t.n()).done;){var r=e.value;r._buffer&&(r._buffer=null)}}catch(i){t.e(i)}finally{t.f()}}},{key:"getWorldExtends",value:function(e){var t=new y.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new y.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach((function(e){if(e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance){var i=e.getBoundingInfo(),n=i.boundingBox.minimumWorld,a=i.boundingBox.maximumWorld;y.P.CheckExtends(n,t,r),y.P.CheckExtends(a,t,r)}})),{min:t,max:r}}},{key:"createPickingRay",value:function(e,t,r,i){throw(0,w.S)("Ray")}},{key:"createPickingRayToRef",value:function(e,t,r,i,n){throw(0,w.S)("Ray")}},{key:"createPickingRayInCameraSpace",value:function(e,t,r){throw(0,w.S)("Ray")}},{key:"createPickingRayInCameraSpaceToRef",value:function(e,t,r,i){throw(0,w.S)("Ray")}},{key:"_pickingAvailable",get:function(){return!1}},{key:"pick",value:function(e,t,r,i,n,a){return new M.p}},{key:"pickWithBoundingInfo",value:function(e,t,r,i,n){return new M.p}},{key:"pickWithRay",value:function(e,t,r,i){throw(0,w.S)("Ray")}},{key:"multiPick",value:function(e,t,r,i,n){throw(0,w.S)("Ray")}},{key:"multiPickWithRay",value:function(e,t,r){throw(0,w.S)("Ray")}},{key:"setPointerOverMesh",value:function(e,t,r){this._inputManager.setPointerOverMesh(e,t,r)}},{key:"getPointerOverMesh",value:function(){return this._inputManager.getPointerOverMesh()}},{key:"_rebuildGeometries",value:function(){var e,t=F(this.geometries);try{for(t.s();!(e=t.n()).done;){e.value._rebuild()}}catch(u){t.e(u)}finally{t.f()}var r,i=F(this.meshes);try{for(i.s();!(r=i.n()).done;){r.value._rebuild()}}catch(u){i.e(u)}finally{i.f()}this.postProcessManager&&this.postProcessManager._rebuild();var n,a=F(this._components);try{for(a.s();!(n=a.n()).done;){n.value.rebuild()}}catch(u){a.e(u)}finally{a.f()}var s,o=F(this.particleSystems);try{for(o.s();!(s=o.n()).done;){s.value.rebuild()}}catch(u){o.e(u)}finally{o.f()}if(this.spriteManagers){var h,l=F(this.spriteManagers);try{for(l.s();!(h=l.n()).done;){h.value.rebuild()}}catch(u){l.e(u)}finally{l.f()}}}},{key:"_rebuildTextures",value:function(){var e,t=F(this.textures);try{for(t.s();!(e=t.n()).done;){e.value._rebuild()}}catch(r){t.e(r)}finally{t.f()}this.markAllMaterialsAsDirty(1)}},{key:"_getByTags",value:function(e,t,r){if(void 0===t)return e;var i=[];for(var n in r=r||function(e){},e){var a=e[n];m.$&&m.$.MatchesQuery(a,t)&&(i.push(a),r(a))}return i}},{key:"getMeshesByTags",value:function(e,t){return this._getByTags(this.meshes,e,t)}},{key:"getCamerasByTags",value:function(e,t){return this._getByTags(this.cameras,e,t)}},{key:"getLightsByTags",value:function(e,t){return this._getByTags(this.lights,e,t)}},{key:"getMaterialByTags",value:function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))}},{key:"getTransformNodesByTags",value:function(e,t){return this._getByTags(this.transformNodes,e,t)}},{key:"setRenderingOrder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(e,t,r,i)}},{key:"setRenderingAutoClearDepthStencil",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(e,t,r,i)}},{key:"getAutoClearDepthStencilSetup",value:function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)}},{key:"blockMaterialDirtyMechanism",get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))}},{key:"markAllMaterialsAsDirty",value:function(e,t){if(!this._blockMaterialDirtyMechanism){var r,i=F(this.materials);try{for(i.s();!(r=i.n()).done;){var n=r.value;t&&!t(n)||n.markAsDirty(e)}}catch(a){i.e(a)}finally{i.f()}}}},{key:"_loadFile",value:function(e,t,r,i,n,a,s){var o=this,h=(0,x.vP)(e,t,r,i?this.offlineProvider:void 0,n,a,s);return this._activeRequests.push(h),h.onCompleteObservable.add((function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)})),h}},{key:"_loadFileAsync",value:function(e,t,r,i,n){var a=this;return new Promise((function(s,o){a._loadFile(e,(function(e){s(e)}),t,r,i,(function(e,t){o(t)}),n)}))}},{key:"_requestFile",value:function(e,t,r,i,n,a,s){var o=this,h=(0,x.FV)(e,t,r,i?this.offlineProvider:void 0,n,a,s);return this._activeRequests.push(h),h.onCompleteObservable.add((function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)})),h}},{key:"_requestFileAsync",value:function(e,t,r,i,n){var a=this;return new Promise((function(s,o){a._requestFile(e,(function(e){s(e)}),t,r,i,(function(e){o(e)}),n)}))}},{key:"_readFile",value:function(e,t,r,i,n){var a=this,s=(0,x.Ip)(e,t,r,i,n);return this._activeRequests.push(s),s.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),s}},{key:"_readFileAsync",value:function(e,t,r){var i=this;return new Promise((function(n,a){i._readFile(e,(function(e){n(e)}),t,r,(function(e){a(e)}))}))}},{key:"getPerfCollector",value:function(){throw(0,w.S)("performanceViewerSceneExtension")}}],[{key:"DefaultMaterialFactory",value:function(e){throw(0,w.S)("StandardMaterial")}},{key:"CollisionCoordinatorFactory",value:function(){throw(0,w.S)("DefaultCollisionCoordinator")}},{key:"DragMovementThreshold",get:function(){return T.$.DragMovementThreshold},set:function(e){T.$.DragMovementThreshold=e}},{key:"LongPressDelay",get:function(){return T.$.LongPressDelay},set:function(e){T.$.LongPressDelay=e}},{key:"DoubleClickDelay",get:function(){return T.$.DoubleClickDelay},set:function(e){T.$.DoubleClickDelay=e}},{key:"ExclusiveDoubleClickMode",get:function(){return T.$.ExclusiveDoubleClickMode},set:function(e){T.$.ExclusiveDoubleClickMode=e}}]),r}(_.p);$.FOGMODE_NONE=0,$.FOGMODE_EXP=1,$.FOGMODE_EXP2=2,$.FOGMODE_LINEAR=3,$.MinDeltaTime=1,$.MaxDeltaTime=1e3,$.prototype.setActiveCameraByID=function(e){return this.setActiveCameraById(e)},$.prototype.getLastMaterialByID=function(e){return this.getLastMaterialById(e)},$.prototype.getMaterialByID=function(e){return this.getMaterialById(e)},$.prototype.getTextureByUniqueID=function(e){return this.getTextureByUniqueId(e)},$.prototype.getCameraByID=function(e){return this.getCameraById(e)},$.prototype.getCameraByUniqueID=function(e){return this.getCameraByUniqueId(e)},$.prototype.getBoneByID=function(e){return this.getBoneById(e)},$.prototype.getLightByID=function(e){return this.getLightById(e)},$.prototype.getLightByUniqueID=function(e){return this.getLightByUniqueId(e)},$.prototype.getParticleSystemByID=function(e){return this.getParticleSystemById(e)},$.prototype.getGeometryByID=function(e){return this.getGeometryById(e)},$.prototype.getMeshByID=function(e){return this.getMeshById(e)},$.prototype.getMeshesByID=function(e){return this.getMeshesById(e)},$.prototype.getTransformNodeByID=function(e){return this.getTransformNodeById(e)},$.prototype.getTransformNodeByUniqueID=function(e){return this.getTransformNodeByUniqueId(e)},$.prototype.getTransformNodesByID=function(e){return this.getTransformNodesById(e)},$.prototype.getMeshByUniqueID=function(e){return this.getMeshByUniqueId(e)},$.prototype.getLastMeshByID=function(e){return this.getLastMeshById(e)},$.prototype.getLastEntryByID=function(e){return this.getLastEntryById(e)},$.prototype.getNodeByID=function(e){return this.getNodeById(e)},$.prototype.getLastSkeletonByID=function(e){return this.getLastSkeletonById(e)}}}]);
//# sourceMappingURL=702596cc-be0f5577a3a3717164ae.js.map