"use strict";(self.webpackChunk_react_babylonjs_docs=self.webpackChunk_react_babylonjs_docs||[]).push([[863],{12042:function(e,t,r){r.d(t,{B:function(){return I}});var i=r(34795),n=r(87371),s=r(9249),a=r(82841),u=r.n(a),l=r(38962),o=r(744),_=r(8374),h=r(12508),c=r(75094),f=r(84072),d=r(30983),g=r(54446),v=r(24281),E=r(2307),p=r(38977),T=r(30253),x=r(54942),R=r(29031),b=r(47736),m=r(23163),A=r(58863),y=r(74632),S=r(57063),C=r(18322);function B(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw s}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var L=(0,n.Z)((function e(){(0,s.Z)(this,e)})),I=function(){function e(t,r,i,n){var a=this;(0,s.Z)(this,e),this._name="WebGL",this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new h.y$,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new h.y$,this.onContextRestoredObservable=new h.y$,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new c.k,this._stencilStateComposer=new y.C,this._stencilState=new f.s,this._alphaState=new d.Q,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new h.y$,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._useExactSrgbConversions=!1,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},this.startTime=C.F.Now;var u=null;if(i=i||{},this._creationOptions=i,this.adaptToDeviceRatio=null!=n&&n,this._stencilStateComposer.stencilGlobal=this._stencilState,b.Z.SetMatrixPrecision(!!i.useHighPrecisionMatrix),t){if(n=n||i.adaptToDeviceRatio||!1,t.getContext){if(u=t,this._renderingCanvas=u,void 0!==r&&(i.antialias=r),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.timeStep&&(i.timeStep=1/60),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0!==i.audioEngineOptions&&void 0!==i.audioEngineOptions.audioContext&&(this._audioContext=i.audioEngineOptions.audioContext),void 0!==i.audioEngineOptions&&void 0!==i.audioEngineOptions.audioDestination&&(this._audioDestination=i.audioEngineOptions.audioDestination),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===i.xrCompatible&&(i.xrCompatible=!0),void 0!==i.useExactSrgbConversions&&(this._useExactSrgbConversions=i.useExactSrgbConversions),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var e=navigator.userAgent;a.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&(0,E.n5)()&&"ontouchend"in document},this._checkForMobile(),(0,E.CG)()&&window.addEventListener("resize",this._checkForMobile);var l,o=navigator.userAgent,_=B(e.ExceptionList);try{for(_.s();!(l=_.n()).done;){var g=l.value,x=g.key,R=g.targets;if(new RegExp(x).test(o)){if(g.capture&&g.captureConstraint){var m=g.capture,A=g.captureConstraint,S=new RegExp(m).exec(o);if(S&&S.length>0)if(parseInt(S[S.length-1])>=A)continue}var w,I=B(R);try{for(I.s();!(w=I.n()).done;){switch(w.value){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":i.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}catch(M){I.e(M)}finally{I.f()}}}}catch(M){_.e(M)}finally{_.f()}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),a._contextWasLost=!0,v.Y.Warn("WebGL context lost."),a.onContextLostObservable.notifyObservers(a)},this._onContextRestored=function(){a._restoreEngineAfterContextLost(a._initGLContext.bind(a))},u.addEventListener("webglcontextlost",this._onContextLost,!1),u.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(i.xrCompatible=!1),!i.disableWebGL2Support)try{this._gl=u.getContext("webgl2",i)||u.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(U){}if(!this._gl){if(!u)throw new Error("The provided canvas is null or undefined.");try{this._gl=u.getContext("webgl",i)||u.getContext("experimental-webgl",i)}catch(U){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var k=this._gl.getContextAttributes();k&&(i.stencil=k.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var F=(0,E.CG)()&&window.devicePixelRatio||1,P=i.limitDeviceRatio||F;this._hardwareScalingLevel=n?1/Math.min(P,F):1,this._lastDevicePixelRatio=F,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext(),this._initFeatures();for(var G=0;G<this._caps.maxVertexAttribs;G++)this._currentBufferPointers[G]=new L;this._shaderProcessor=this.webGLVersion>1?new T.C:new p.f,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);var D="Babylon.js v".concat(e.Version);console.log(D+" - ".concat(this.description)),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",D)}}return(0,n.Z)(e,[{key:"description",get:function(){var e=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"version",get:function(){return this._webGLVersion}},{key:"_getShaderProcessor",value:function(e){return this._shaderProcessor}},{key:"useReverseDepthBuffer",get:function(){return this._useReverseDepthBuffer},set:function(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)}},{key:"frameId",get:function(){return this._frameId}},{key:"supportsUniformBuffers",get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers}},{key:"getCreationOptions",value:function(){return this._creationOptions}},{key:"_shouldUseHighPrecisionShader",get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}},{key:"needPOTTextures",get:function(){return this._webGLVersion<2||this.forcePOTTextures}},{key:"activeRenderLoops",get:function(){return this._activeRenderLoops}},{key:"doNotHandleContextLost",get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e}},{key:"_supportsHardwareTextureRescaling",get:function(){return!1}},{key:"framebufferDimensionsObject",set:function(e){this._framebufferDimensionsObject=e}},{key:"currentViewport",get:function(){return this._cachedViewport}},{key:"emptyTexture",get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}},{key:"emptyTexture3D",get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}},{key:"emptyTexture2DArray",get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}},{key:"emptyCubeTexture",get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}},{key:"isWebGPU",get:function(){return this._isWebGPU}},{key:"shaderPlatformName",get:function(){return this._shaderPlatformName}},{key:"snapshotRendering",get:function(){return!1},set:function(e){}},{key:"snapshotRenderingMode",get:function(){return this._snapshotRenderingMode},set:function(e){this._snapshotRenderingMode=e}},{key:"useExactSrgbConversions",get:function(){return this._useExactSrgbConversions}},{key:"snapshotRenderingReset",value:function(){this.snapshotRendering=!1}},{key:"createCanvas",value:function(t,r){return e._CreateCanvas(t,r)}},{key:"createCanvasImage",value:function(){return document.createElement("img")}},{key:"_restoreEngineAfterContextLost",value:function(e){var t=this;setTimeout((0,i.Z)(u().mark((function r(){var i,n,s,a,l;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t._dummyFramebuffer=null,n=t._depthCullingState.depthTest,s=t._depthCullingState.depthFunc,a=t._depthCullingState.depthMask,l=t._stencilState.stencilTest,r.next=7,e();case 7:t.wipeCaches(!0),t._rebuildEffects(),null===(i=t._rebuildComputeEffects)||void 0===i||i.call(t),t._rebuildBuffers(),t._rebuildInternalTextures(),t._rebuildRenderTargetWrappers(),t.wipeCaches(!0),t._depthCullingState.depthTest=n,t._depthCullingState.depthFunc=s,t._depthCullingState.depthMask=a,t._stencilState.stencilTest=l,v.Y.Warn(t.name+" context successfully restored."),t.onContextRestoredObservable.notifyObservers(t),t._contextWasLost=!1;case 21:case"end":return r.stop()}}),r)}))),0)}},{key:"_sharedInit",value:function(e,t,r){this._renderingCanvas=e}},{key:"_getShaderProcessingContext",value:function(e){return null}},{key:"_rebuildInternalTextures",value:function(){var e,t=B(this._internalTexturesCache.slice());try{for(t.s();!(e=t.n()).done;){e.value._rebuild()}}catch(r){t.e(r)}finally{t.f()}}},{key:"_rebuildRenderTargetWrappers",value:function(){var e,t=B(this._renderTargetWrapperCache.slice());try{for(t.s();!(e=t.n()).done;){e.value._rebuild()}}catch(r){t.e(r)}finally{t.f()}}},{key:"_rebuildEffects",value:function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}o.Q.ResetCache()}},{key:"areAllEffectsReady",value:function(){for(var e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0}},{key:"_rebuildBuffers",value:function(){var e,t=B(this._uniformBuffers);try{for(t.s();!(e=t.n()).done;){e.value._rebuild()}}catch(n){t.e(n)}finally{t.f()}var r,i=B(this._storageBuffers);try{for(i.s();!(r=i.n()).done;){r.value._rebuild()}}catch(n){i.e(n)}finally{i.f()}}},{key:"_initGLContext",value:function(){var e;this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?256:128},this._glVersion=this._gl.getParameter(this._gl.VERSION);var t=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=t&&(this._glRenderer=this._gl.getParameter(t.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(t.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(null!==(e=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT))&&void 0!==e?e:0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{var r=this._gl.getExtension("WEBGL_draw_buffers");if(null!==r){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=r.drawBuffersWEBGL.bind(r),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=r["COLOR_ATTACHMENT"+i+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var n=this._gl.getExtension("WEBGL_depth_texture");null!=n&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=n.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var s=this._gl.getExtension("OES_vertex_array_object");null!=s&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=s.createVertexArrayOES.bind(s),this._gl.bindVertexArray=s.bindVertexArrayOES.bind(s),this._gl.deleteVertexArray=s.deleteVertexArrayOES.bind(s))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var a=this._gl.getExtension("ANGLE_instanced_arrays");null!=a?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a),this._gl.drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._gl.vertexAttribDivisor=a.vertexAttribDivisorANGLE.bind(a)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var u=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),l=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);u&&l&&(this._caps.highPrecisionShaderSupported=0!==u.precision&&0!==l.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var o=this._gl.getExtension("EXT_blend_minmax");null!=o&&(this._caps.blendMinMax=!0,this._gl.MAX=o.MAX_EXT,this._gl.MIN=o.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{var _=this._gl.getExtension("EXT_sRGB");null!=_&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=_.SRGB_EXT,this._gl.SRGB8=_.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=_.SRGB_ALPHA_EXT)}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var h=0;h<this._maxSimultaneousTextures;h++)this._nextFreeTextureSlots.push(h)}},{key:"_initFeatures",value:function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,_collectUbosUpdatedInFrame:!1}}},{key:"webGLVersion",get:function(){return this._webGLVersion}},{key:"getClassName",value:function(){return"ThinEngine"}},{key:"isStencilEnable",get:function(){return this._isStencilEnable}},{key:"_prepareWorkingCanvas",value:function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}}},{key:"resetTextureCache",value:function(){for(var e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1}},{key:"getInfo",value:function(){return this.getGlInfo()}},{key:"getGlInfo",value:function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}},{key:"setHardwareScalingLevel",value:function(e){this._hardwareScalingLevel=e,this.resize()}},{key:"getHardwareScalingLevel",value:function(){return this._hardwareScalingLevel}},{key:"getLoadedTexturesCache",value:function(){return this._internalTexturesCache}},{key:"getCaps",value:function(){return this._caps}},{key:"stopRenderLoop",value:function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]}},{key:"_renderLoop",value:function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1}},{key:"getRenderingCanvas",value:function(){return this._renderingCanvas}},{key:"getAudioContext",value:function(){return this._audioContext}},{key:"getAudioDestination",value:function(){return this._audioDestination}},{key:"getHostWindow",value:function(){return(0,E.CG)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}},{key:"getRenderWidth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}},{key:"getRenderHeight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}},{key:"_queueNewFrame",value:function(t,r){return e.QueueNewFrame(t,r)}},{key:"runRenderLoop",value:function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}},{key:"clear",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=n;var s=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),s|=this._gl.COLOR_BUFFER_BIT),r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),s|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),s|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(s)}},{key:"_viewport",value:function(e,t,r,i){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i,this._gl.viewport(e,t,r,i))}},{key:"setViewport",value:function(e,t,r){var i=t||this.getRenderWidth(),n=r||this.getRenderHeight(),s=e.x||0,a=e.y||0;this._cachedViewport=e,this._viewport(s*i,a*n,i*e.width,n*e.height)}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){this._badOS&&this.flushFramebuffer(),this._frameId++}},{key:"resize",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){var i=(0,E.CG)()&&window.devicePixelRatio||1,n=this._lastDevicePixelRatio/i;this._lastDevicePixelRatio=i,this._hardwareScalingLevel*=n}(0,E.CG)()?(e=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(e=this._renderingCanvas?this._renderingCanvas.width:100,t=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel,r)}},{key:"setSize",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!this._renderingCanvas&&(e|=0,t|=0,!(!r&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)&&(this._renderingCanvas.width=e,this._renderingCanvas.height=t,!0))}},{key:"bindFramebuffer",value:function(e){var t,r,i,n,s,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,_=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(c._MSAAFramebuffer?c._MSAAFramebuffer:c._framebuffer);var f=this._gl;e.is2DArray?f.framebufferTextureLayer(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,null===(t=e.texture._hardwareTexture)||void 0===t?void 0:t.underlyingResource,_,h):e.isCube&&f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_CUBE_MAP_POSITIVE_X+a,null===(r=e.texture._hardwareTexture)||void 0===r?void 0:r.underlyingResource,_);var d=e._depthStencilTexture;if(d){var g=e._depthStencilTextureWithStencil?f.DEPTH_STENCIL_ATTACHMENT:f.DEPTH_ATTACHMENT;e.is2DArray?f.framebufferTextureLayer(f.FRAMEBUFFER,g,null===(i=d._hardwareTexture)||void 0===i?void 0:i.underlyingResource,_,h):e.isCube?f.framebufferTexture2D(f.FRAMEBUFFER,g,f.TEXTURE_CUBE_MAP_POSITIVE_X+a,null===(n=d._hardwareTexture)||void 0===n?void 0:n.underlyingResource,_):f.framebufferTexture2D(f.FRAMEBUFFER,g,f.TEXTURE_2D,null===(s=d._hardwareTexture)||void 0===s?void 0:s.underlyingResource,_)}this._cachedViewport&&!o?this.setViewport(this._cachedViewport,u,l):(u||(u=e.width,_&&(u/=Math.pow(2,_))),l||(l=e.height,_&&(l/=Math.pow(2,_))),this._viewport(0,0,u,l)),this.wipeCaches()}},{key:"setState",value:function(e){var t,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==e||n)&&(this._depthCullingState.cull=e);var o=null===(r=null!==(t=this.cullBackFaces)&&void 0!==t?t:a)||void 0===r||r?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==o||n)&&(this._depthCullingState.cullFace=o),this.setZOffset(i),this.setZOffsetUnits(l);var _=s?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==_||n)&&(this._depthCullingState.frontFace=_),this._stencilStateComposer.stencilMaterial=u}},{key:"getDepthBuffer",value:function(){return this._depthCullingState.depthTest}},{key:"setDepthBuffer",value:function(e){this._depthCullingState.depthTest=e}},{key:"setZOffset",value:function(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e}},{key:"getZOffset",value:function(){var e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e}},{key:"setZOffsetUnits",value:function(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e}},{key:"getZOffsetUnits",value:function(){var e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e}},{key:"_bindUnboundFramebuffer",value:function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)}},{key:"_currentFrameBufferIsDefaultFrameBuffer",value:function(){return null===this._currentFramebuffer}},{key:"generateMipmaps",value:function(e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)}},{key:"unBindFramebuffer",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,n=e;this._currentRenderTarget=null;var s=this._gl;if(n._MSAAFramebuffer){if(e.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(e,r,i);s.bindFramebuffer(s.READ_FRAMEBUFFER,n._MSAAFramebuffer),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,n._framebuffer),s.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,s.COLOR_BUFFER_BIT,s.NEAREST)}!(null===(t=e.texture)||void 0===t?void 0:t.generateMipMaps)||r||e.isCube||this.generateMipmaps(e.texture),i&&(n._MSAAFramebuffer&&this._bindUnboundFramebuffer(n._framebuffer),i()),this._bindUnboundFramebuffer(null)}},{key:"flushFramebuffer",value:function(){this._gl.flush()}},{key:"restoreDefaultFramebuffer",value:function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}},{key:"_resetVertexBufferBinding",value:function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}},{key:"createVertexBuffer",value:function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)}},{key:"_createVertexBuffer",value:function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var i=new x.M(r);return this.bindArrayBuffer(i),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),this._resetVertexBufferBinding(),i.references=1,i}},{key:"createDynamicVertexBuffer",value:function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)}},{key:"_resetIndexBufferBinding",value:function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}},{key:"createIndexBuffer",value:function(e,t){var r=this._gl.createBuffer(),i=new x.M(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=4===n.BYTES_PER_ELEMENT,i}},{key:"_normalizeIndexData",value:function(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)}},{key:"bindArrayBuffer",value:function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)}},{key:"bindUniformBlock",value:function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,n,r)}},{key:"bindIndexBuffer",value:function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)}},{key:"_bindBuffer",value:function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)}},{key:"updateArrayBuffer",value:function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)}},{key:"_vertexAttribPointer",value:function(e,t,r,i,n,s,a){var u=this._currentBufferPointers[t];if(u){var l=!1;u.active?(u.buffer!==e&&(u.buffer=e,l=!0),u.size!==r&&(u.size=r,l=!0),u.type!==i&&(u.type=i,l=!0),u.normalized!==n&&(u.normalized=n,l=!0),u.stride!==s&&(u.stride=s,l=!0),u.offset!==a&&(u.offset=a,l=!0)):(l=!0,u.active=!0,u.index=t,u.size=r,u.type=i,u.normalized=n,u.stride=s,u.offset=a,u.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),i===this._gl.UNSIGNED_INT||i===this._gl.INT?this._gl.vertexAttribIPointer(t,r,i,s,a):this._gl.vertexAttribPointer(t,r,i,n,s,a))}}},{key:"_bindIndexBufferWithCache",value:function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)}},{key:"_bindVertexBuffersAttributes",value:function(e,t,r){var i=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var n=0;n<i.length;n++){var s=t.getAttributeLocation(n);if(s>=0){var a=i[n],u=null;if(r&&(u=r[a]),u||(u=e[a]),!u)continue;this._gl.enableVertexAttribArray(s),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[s]=!0);var l=u.getBuffer();l&&(this._vertexAttribPointer(l,s,u.getSize(),u.type,u.normalized,u.byteStride,u.byteOffset),u.getIsInstanced()&&(this._gl.vertexAttribDivisor(s,u.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(l))))}}}},{key:"recordVertexArrayObject",value:function(e,t,r,i){var n=this._gl.createVertexArray();if(!n)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(n),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r,i),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),n}},{key:"bindVertexArrayObject",value:function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)}},{key:"bindBuffersDirectly",value:function(e,t,r,i,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var s=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var a=0,u=0;u<s;u++)if(u<r.length){var l=n.getAttributeLocation(u);l>=0&&(this._gl.enableVertexAttribArray(l),this._vertexAttribArraysEnabled[l]=!0,this._vertexAttribPointer(e,l,r[u],this._gl.FLOAT,!1,i,a)),a+=4*r[u]}}this._bindIndexBufferWithCache(t)}},{key:"_unbindVertexArrayObject",value:function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}},{key:"bindBuffers",value:function(e,t,r,i){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r,i)),this._bindIndexBufferWithCache(t)}},{key:"unbindInstanceAttributes",value:function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}},{key:"releaseVertexArrayObject",value:function(e){this._gl.deleteVertexArray(e)}},{key:"_releaseBuffer",value:function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)}},{key:"_deleteBuffer",value:function(e){this._gl.deleteBuffer(e.underlyingResource)}},{key:"updateAndBindInstancesBuffer",value:function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index)this.bindInstancesBuffer(e,r,!0);else for(var i=0;i<4;i++){var n=r[i];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*i),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}}},{key:"bindInstancesBuffer",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(e);var i=0;if(r)for(var n=0;n<t.length;n++){var s=t[n];i+=4*s.attributeSize}for(var a=0;a<t.length;a++){var u=t[a];void 0===u.index&&(u.index=this._currentEffect.getAttributeLocationByName(u.attributeName)),u.index<0||(this._vertexAttribArraysEnabled[u.index]||(this._gl.enableVertexAttribArray(u.index),this._vertexAttribArraysEnabled[u.index]=!0),this._vertexAttribPointer(e,u.index,u.attributeSize,u.attributeType||this._gl.FLOAT,u.normalized||!1,i,u.offset),this._gl.vertexAttribDivisor(u.index,void 0===u.divisor?1:u.divisor),this._currentInstanceLocations.push(u.index),this._currentInstanceBuffers.push(e))}}},{key:"disableInstanceAttributeByName",value:function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}}},{key:"disableInstanceAttribute",value:function(e){for(var t,r=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),r=!0,t=this._currentInstanceLocations.indexOf(e);r&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))}},{key:"disableAttributeByIndex",value:function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}},{key:"draw",value:function(e,t,r,i){this.drawElementsType(e?0:1,t,r,i)}},{key:"drawPointClouds",value:function(e,t,r){this.drawArraysType(2,e,t,r)}},{key:"drawUnIndexed",value:function(e,t,r,i){this.drawArraysType(e?0:1,t,r,i)}},{key:"drawElementsType",value:function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(n,r,s,t*a,i):this._gl.drawElements(n,r,s,t*a)}},{key:"drawArraysType",value:function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);i?this._gl.drawArraysInstanced(n,t,r,i):this._gl.drawArrays(n,t,r)}},{key:"_drawMode",value:function(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}},{key:"_reportDrawCall",value:function(){}},{key:"_releaseEffect",value:function(e){this._compiledEffects[e._key]&&delete this._compiledEffects[e._key];var t=e.getPipelineContext();t&&this._deletePipelineContext(t)}},{key:"_deletePipelineContext",value:function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))}},{key:"_getGlobalDefines",value:function(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS);var t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(t&&(t+="\n"),t+="#define USE_EXACT_SRGB_CONVERSIONS"),t}},{key:"createEffect",value:function(e,t,r,i,n,s,a,u,l){var _,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:S.x.GLSL,c=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,f=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,d=this._getGlobalDefines(),g=null!==(_=null!=n?n:t.defines)&&void 0!==_?_:"";d&&(g+=d);var v=c+"+"+f+"@"+g;if(this._compiledEffects[v]){var E=this._compiledEffects[v];return a&&E.isReady()&&a(E),E}var p=new o.Q(e,t,r,i,this,n,s,a,u,l,v,h);return this._compiledEffects[v]=p,p}},{key:"_compileShader",value:function(t,r,i,n){return this._compileRawShader(e._ConcatenateShader(t,i,n),r)}},{key:"_compileRawShader",value:function(e,t){var r=this._gl,i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i){for(var n=r.NO_ERROR,s=r.NO_ERROR;(s=r.getError())!==r.NO_ERROR;)n=s;throw new Error("Something went wrong while creating a gl ".concat(t," shader object. gl error=").concat(n,", gl isContextLost=").concat(r.isContextLost(),", _contextWasLost=").concat(this._contextWasLost))}return r.shaderSource(i,e),r.compileShader(i),i}},{key:"_getShaderSource",value:function(e){return this._gl.getShaderSource(e)}},{key:"createRawShaderProgram",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;i=i||this._gl;var s=this._compileRawShader(t,"vertex"),a=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,s,a,i,n)}},{key:"createShaderProgram",value:function(e,t,r,i,n){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;n=n||this._gl;var a=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",u=this._compileShader(t,"vertex",i,a),l=this._compileShader(r,"fragment",i,a);return this._createShaderProgram(e,u,l,n,s)}},{key:"inlineShaderCode",value:function(e){return e}},{key:"createPipelineContext",value:function(e){var t=new R.y;return t.engine=this,this._caps.parallelShaderCompile&&(t.isParallelCompiled=!0),t}},{key:"createMaterialContext",value:function(){}},{key:"createDrawContext",value:function(){}},{key:"_createShaderProgram",value:function(e,t,r,i){var n=i.createProgram();if(e.program=n,!n)throw new Error("Unable to create program");return i.attachShader(n,t),i.attachShader(n,r),i.linkProgram(n),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),n}},{key:"_finalizePipelineContext",value:function(e){var t=e.context,r=e.vertexShader,i=e.fragmentShader,n=e.program;if(!t.getProgramParameter(n,t.LINK_STATUS)){if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)){var s=this._gl.getShaderInfoLog(r);if(s)throw e.vertexCompilationError=s,new Error("VERTEX SHADER "+s)}if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)){var a=this._gl.getShaderInfoLog(i);if(a)throw e.fragmentCompilationError=a,new Error("FRAGMENT SHADER "+a)}var u=t.getProgramInfoLog(n);if(u)throw e.programLinkError=u,new Error(u)}if(this.validateShaderPrograms&&(t.validateProgram(n),!t.getProgramParameter(n,t.VALIDATE_STATUS))){var l=t.getProgramInfoLog(n);if(l)throw e.programValidationError=l,new Error(l)}t.deleteShader(r),t.deleteShader(i),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}},{key:"_preparePipelineContext",value:function(e,t,r,i,n,s,a,u,l,o){var _=e;_.program=i?this.createRawShaderProgram(_,t,r,void 0,l):this.createShaderProgram(_,t,r,u,void 0,l),_.program.__SPECTOR_rebuildProgram=a}},{key:"_isRenderingStateCompiled",value:function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)}},{key:"_executeWhenRenderingStateIsCompiled",value:function(e,t){var r=e;if(r.isParallelCompiled){var i=r.onCompiled;r.onCompiled=i?function(){i(),t()}:t}else t()}},{key:"getUniforms",value:function(e,t){for(var r=new Array,i=e,n=0;n<t.length;n++)r.push(this._gl.getUniformLocation(i.program,t[n]));return r}},{key:"getAttributes",value:function(e,t){for(var r=[],i=e,n=0;n<t.length;n++)try{r.push(this._gl.getAttribLocation(i.program,t[n]))}catch(s){r.push(-1)}return r}},{key:"enableEffect",value:function(e){(e=null!==e&&A.q.IsWrapper(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))}},{key:"setInt",value:function(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)}},{key:"setInt2",value:function(e,t,r){return!!e&&(this._gl.uniform2i(e,t,r),!0)}},{key:"setInt3",value:function(e,t,r,i){return!!e&&(this._gl.uniform3i(e,t,r,i),!0)}},{key:"setInt4",value:function(e,t,r,i,n){return!!e&&(this._gl.uniform4i(e,t,r,i,n),!0)}},{key:"setIntArray",value:function(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)}},{key:"setIntArray2",value:function(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2iv(e,t),!0)}},{key:"setIntArray3",value:function(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3iv(e,t),!0)}},{key:"setIntArray4",value:function(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4iv(e,t),!0)}},{key:"setArray",value:function(e,t){return!!e&&(!(t.length<1)&&(this._gl.uniform1fv(e,t),!0))}},{key:"setArray2",value:function(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2fv(e,t),!0)}},{key:"setArray3",value:function(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3fv(e,t),!0)}},{key:"setArray4",value:function(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4fv(e,t),!0)}},{key:"setMatrices",value:function(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)}},{key:"setMatrix3x3",value:function(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)}},{key:"setMatrix2x2",value:function(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)}},{key:"setFloat",value:function(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)}},{key:"setFloat2",value:function(e,t,r){return!!e&&(this._gl.uniform2f(e,t,r),!0)}},{key:"setFloat3",value:function(e,t,r,i){return!!e&&(this._gl.uniform3f(e,t,r,i),!0)}},{key:"setFloat4",value:function(e,t,r,i,n){return!!e&&(this._gl.uniform4f(e,t,r,i,n),!0)}},{key:"applyStates",value:function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}}},{key:"setColorWrite",value:function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)}},{key:"getColorWrite",value:function(){return this._colorWrite}},{key:"depthCullingState",get:function(){return this._depthCullingState}},{key:"alphaState",get:function(){return this._alphaState}},{key:"stencilState",get:function(){return this._stencilState}},{key:"stencilStateComposer",get:function(){return this._stencilStateComposer}},{key:"clearInternalTexturesCache",value:function(){this._internalTexturesCache.length=0}},{key:"wipeCaches",value:function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}},{key:"_getSamplingParameters",value:function(e,t){var r=this._gl,i=r.NEAREST,n=r.NEAREST;switch(e){case 11:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 3:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 8:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 4:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 5:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 6:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 7:i=r.NEAREST,n=r.LINEAR;break;case 1:i=r.NEAREST,n=r.NEAREST;break;case 9:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 10:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 2:i=r.LINEAR,n=r.LINEAR;break;case 12:i=r.LINEAR,n=r.NEAREST}return{min:n,mag:i}}},{key:"_createTexture",value:function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e}},{key:"_createHardwareTexture",value:function(){return new m.B(this._createTexture(),this._gl)}},{key:"_createInternalTexture",value:function(e,t){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.S.Unknown,n=!1,s=0,a=3,u=5,l=!1,o=1;void 0!==t&&"object"==typeof t?(n=!!t.generateMipMaps,s=void 0===t.type?0:t.type,a=void 0===t.samplingMode?3:t.samplingMode,u=void 0===t.format?5:t.format,l=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer,o=null!==(r=t.samples)&&void 0!==r?r:1):n=!!t,l&&(l=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==s||this._caps.textureFloatLinearFiltering)&&(2!==s||this._caps.textureHalfFloatLinearFiltering)||(a=1),1!==s||this._caps.textureFloat||(s=0,v.Y.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var _=this._gl,h=new g.l(this,i),c=e.width||e,f=e.height||e,d=e.layers||0,E=this._getSamplingParameters(a,n),p=0!==d?_.TEXTURE_2D_ARRAY:_.TEXTURE_2D,T=this._getRGBABufferInternalSizedFormat(s,u,l),x=this._getInternalFormat(u),R=this._getWebGLTextureType(s);return this._bindTextureDirectly(p,h),0!==d?(h.is2DArray=!0,_.texImage3D(p,0,T,c,f,d,0,x,R,null)):_.texImage2D(p,0,T,c,f,0,x,R,null),_.texParameteri(p,_.TEXTURE_MAG_FILTER,E.mag),_.texParameteri(p,_.TEXTURE_MIN_FILTER,E.min),_.texParameteri(p,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(p,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),n&&this._gl.generateMipmap(p),this._bindTextureDirectly(p,null),h._useSRGBBuffer=l,h.baseWidth=c,h.baseHeight=f,h.width=c,h.height=f,h.depth=d,h.isReady=!0,h.samples=o,h.generateMipMaps=n,h.samplingMode=a,h.type=s,h.format=u,this._internalTexturesCache.push(h),h}},{key:"_getUseSRGBBuffer",value:function(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||t)}},{key:"_createTextureBase",value:function(t,r,i,n){var s=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,_=arguments.length>7?arguments[7]:void 0,h=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,p=arguments.length>13?arguments[13]:void 0,T=arguments.length>14?arguments[14]:void 0,x=arguments.length>15?arguments[15]:void 0,R="data:"===(t=t||"").substr(0,5),b="blob:"===t.substr(0,5),m=R&&-1!==t.indexOf(";base64,"),A=f||new g.l(this,g.S.Url),y=t;!this._transformTextureUrl||m||f||c||(t=this._transformTextureUrl(t)),y!==t&&(A._originalUrl=y);var S=t.lastIndexOf("."),C=E||(S>-1?t.substring(S).toLowerCase():""),w=null,L=C.indexOf("?");L>-1&&(C=C.split("?")[0]);var I,k=B(e._TextureLoaders);try{for(k.s();!(I=k.n()).done;){var F=I.value;if(F.canLoad(C,p)){w=F;break}}}catch(U){k.e(U)}finally{k.f()}n&&n.addPendingData(A),A.url=t,A.generateMipMaps=!r,A.samplingMode=a,A.invertY=i,A._useSRGBBuffer=this._getUseSRGBBuffer(!!x,r),this._doNotHandleContextLost||(A._buffer=c);var P=null;u&&!f&&(P=A.onLoadedObservable.add(u)),f||this._internalTexturesCache.push(A);var G=function(e,i){n&&n.removePendingData(A),t===y?(P&&A.onLoadedObservable.remove(P),l.l.UseFallbackTexture&&s._createTextureBase(l.l.FallbackTexture,r,A.invertY,n,a,null,o,_,h,c,A),e=(e||"Unknown error")+(l.l.UseFallbackTexture?" - Fallback texture was used":""),A.onErrorObservable.notifyObservers({message:e,exception:i}),o&&o(e,i)):(v.Y.Warn("Failed to load ".concat(t,", falling back to ").concat(y)),s._createTextureBase(y,r,A.invertY,n,a,u,o,_,h,c,A,d,E,p,T,x))};if(w){var D=function(e){w.loadData(e,A,(function(e,t,r,i,s,u){u?G("TextureLoader failed to load data"):_(A,C,n,{width:e,height:t},A.invertY,!r,i,(function(){return s(),!1}),a)}),T)};c?c instanceof ArrayBuffer?D(new Uint8Array(c)):ArrayBuffer.isView(c)?D(c):o&&o("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(function(e){return D(new Uint8Array(e))}),void 0,n?n.offlineProvider:void 0,!0,(function(e,t){G("Unable to load "+(e&&e.responseURL,t))}))}else{var M=function(e){b&&!s._doNotHandleContextLost&&(A._buffer=e),_(A,C,n,e,A.invertY,r,!1,h,a)};!R||m?c&&("string"==typeof c.decoding||c.close)?M(c):e._FileToolsLoadImage(t,M,G,n?n.offlineProvider:null,p,A.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof c||c instanceof ArrayBuffer||ArrayBuffer.isView(c)||c instanceof Blob?e._FileToolsLoadImage(c,M,G,n?n.offlineProvider:null,p,A.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):c&&M(c)}return A}},{key:"createTexture",value:function(e,t,r,i){var n=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,_=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,c=arguments.length>11?arguments[11]:void 0,f=arguments.length>12?arguments[12]:void 0,d=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(e,t,r,i,s,a,u,this._prepareWebGLTexture.bind(this),(function(e,t,r,s,a,u){var l=n._gl,o=r.width===e&&r.height===t,h=_?n._getInternalFormat(_,a._useSRGBBuffer):".jpg"!==s||a._useSRGBBuffer?a._useSRGBBuffer?l.SRGB8_ALPHA8:l.RGBA:l.RGB,c=_?n._getInternalFormat(_):".jpg"!==s||a._useSRGBBuffer?l.RGBA:l.RGB;if(a._useSRGBBuffer&&1===n.webGLVersion&&(c=h),o)return l.texImage2D(l.TEXTURE_2D,0,h,c,l.UNSIGNED_BYTE,r),!1;var f=n._caps.maxTextureSize;if(r.width>f||r.height>f||!n._supportsHardwareTextureRescaling)return n._prepareWorkingCanvas(),!(!n._workingCanvas||!n._workingContext)&&(n._workingCanvas.width=e,n._workingCanvas.height=t,n._workingContext.drawImage(r,0,0,r.width,r.height,0,0,e,t),l.texImage2D(l.TEXTURE_2D,0,h,c,l.UNSIGNED_BYTE,n._workingCanvas),a.width=e,a.height=t,!1);var d=new g.l(n,g.S.Temp);return n._bindTextureDirectly(l.TEXTURE_2D,d,!0),l.texImage2D(l.TEXTURE_2D,0,h,c,l.UNSIGNED_BYTE,r),n._rescaleTexture(d,a,i,h,(function(){n._releaseTexture(d),n._bindTextureDirectly(l.TEXTURE_2D,a,!0),u()})),!0}),l,o,_,h,c,f,d)}},{key:"_rescaleTexture",value:function(e,t,r,i,n){}},{key:"createRawTexture",value:function(e,t,r,i,n,s,a){throw(0,_.S)("Engine.RawTexture")}},{key:"createRawCubeTexture",value:function(e,t,r,i,n,s,a){throw(0,_.S)("Engine.RawTexture")}},{key:"createRawTexture3D",value:function(e,t,r,i,n,s,a,u){throw(0,_.S)("Engine.RawTexture")}},{key:"createRawTexture2DArray",value:function(e,t,r,i,n,s,a,u){throw(0,_.S)("Engine.RawTexture")}},{key:"_unpackFlipY",value:function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))}},{key:"_getUnpackAlignement",value:function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}},{key:"_getTextureTarget",value:function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}},{key:"updateTextureSamplingMode",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||r);this._setTextureParameterInteger(i,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(i,this._gl.TEXTURE_MIN_FILTER,n.min),r&&(t.generateMipMaps=!0,this._gl.generateMipmap(i)),this._bindTextureDirectly(i,null),t.samplingMode=e}},{key:"updateTextureDimensions",value:function(e,t,r){}},{key:"updateTextureWrappingMode",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==r&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),e),e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(i),e),e._cachedWrapR=i),this._bindTextureDirectly(n,null)}},{key:"_setupDepthStencilTexture",value:function(e,t,r,i,n){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=t.width||t,u=t.height||t,l=t.layers||0;e.baseWidth=a,e.baseHeight=u,e.width=a,e.height=u,e.is2DArray=l>0,e.depth=l,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=n;var o=this._gl,_=this._getTextureTarget(e),h=this._getSamplingParameters(e.samplingMode,!1);o.texParameteri(_,o.TEXTURE_MAG_FILTER,h.mag),o.texParameteri(_,o.TEXTURE_MIN_FILTER,h.min),o.texParameteri(_,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(_,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===n?(o.texParameteri(_,o.TEXTURE_COMPARE_FUNC,515),o.texParameteri(_,o.TEXTURE_COMPARE_MODE,o.NONE)):(o.texParameteri(_,o.TEXTURE_COMPARE_FUNC,n),o.texParameteri(_,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE)))}},{key:"_uploadCompressedDataToTextureDirectly",value:function(e,t,r,i,n){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=this._gl,l=u.TEXTURE_2D;if(e.isCube&&(l=u.TEXTURE_CUBE_MAP_POSITIVE_X+s),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=u.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=u.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=u.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=u.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=u.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=u.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=u.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(l,a,t,r,i,0,n)}},{key:"_uploadDataToTextureDirectly",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=this._gl,u=this._getWebGLTextureType(e.type),l=this._getInternalFormat(e.format),o=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(n,e._useSRGBBuffer);this._unpackFlipY(e.invertY);var _=a.TEXTURE_2D;e.isCube&&(_=a.TEXTURE_CUBE_MAP_POSITIVE_X+r);var h=Math.round(Math.log(e.width)*Math.LOG2E),c=Math.round(Math.log(e.height)*Math.LOG2E),f=s?e.width:Math.pow(2,Math.max(h-i,0)),d=s?e.height:Math.pow(2,Math.max(c-i,0));a.texImage2D(_,i,o,f,d,0,l,u,t)}},{key:"updateTextureData",value:function(e,t,r,i,n,s){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],o=this._gl,_=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var c=o.TEXTURE_2D,f=o.TEXTURE_2D;e.isCube&&(f=o.TEXTURE_CUBE_MAP_POSITIVE_X+a,c=o.TEXTURE_CUBE_MAP),this._bindTextureDirectly(c,e,!0),o.texSubImage2D(f,u,r,i,n,s,h,_,t),l&&this._gl.generateMipmap(f),this._bindTextureDirectly(c,null)}},{key:"_uploadArrayBufferViewToTexture",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this._gl,s=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,r,i),this._bindTextureDirectly(s,null,!0)}},{key:"_prepareWebGLTextureContinuation",value:function(e,t,r,i,n){var s=this._gl;if(s){var a=this._getSamplingParameters(n,!r);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,a.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,a.min),r||i||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t.removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}}},{key:"_prepareWebGLTexture",value:function(t,r,i,n,s,a,u,l){var o=this,_=arguments.length>8&&void 0!==arguments[8]?arguments[8]:3,h=this.getCaps().maxTextureSize,c=Math.min(h,this.needPOTTextures?e.GetExponentOfTwo(n.width,h):n.width),f=Math.min(h,this.needPOTTextures?e.GetExponentOfTwo(n.height,h):n.height),d=this._gl;d&&(t._hardwareTexture?(this._bindTextureDirectly(d.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===s||!!s),t.baseWidth=n.width,t.baseHeight=n.height,t.width=c,t.height=f,t.isReady=!0,l(c,f,n,r,t,(function(){o._prepareWebGLTextureContinuation(t,i,a,u,_)}))||this._prepareWebGLTextureContinuation(t,i,a,u,_)):i&&i.removePendingData(t))}},{key:"_setupFramebufferDepthAttachments",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=this._gl;if(e&&t)return this._createRenderBuffer(r,i,n,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT);if(t){var a=s.DEPTH_COMPONENT16;return this._webGLVersion>1&&(a=s.DEPTH_COMPONENT32F),this._createRenderBuffer(r,i,n,a,a,s.DEPTH_ATTACHMENT)}return e?this._createRenderBuffer(r,i,n,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null}},{key:"_createRenderBuffer",value:function(e,t,r,i,n,s){var a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=this._gl,l=u.createRenderbuffer();return this._updateRenderBuffer(l,e,t,r,i,n,s,a)}},{key:"_updateRenderBuffer",value:function(e,t,r,i,n,s,a){var u=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=this._gl;return l.bindRenderbuffer(l.RENDERBUFFER,e),i>1&&l.renderbufferStorageMultisample?l.renderbufferStorageMultisample(l.RENDERBUFFER,i,s,t,r):l.renderbufferStorage(l.RENDERBUFFER,n,t,r),l.framebufferRenderbuffer(l.FRAMEBUFFER,a,l.RENDERBUFFER,e),u&&l.bindRenderbuffer(l.RENDERBUFFER,null),e}},{key:"_releaseTexture",value:function(e){var t;this._deleteTexture(null===(t=e._hardwareTexture)||void 0===t?void 0:t.underlyingResource),this.unbindAllTextures();var r=this._internalTexturesCache.indexOf(e);-1!==r&&this._internalTexturesCache.splice(r,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()}},{key:"_releaseRenderTargetWrapper",value:function(e){var t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)}},{key:"_deleteTexture",value:function(e){e&&this._gl.deleteTexture(e)}},{key:"_setProgram",value:function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)}},{key:"bindSamplers",value:function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),i=0;i<r.length;i++){var n=e.getUniform(r[i]);n&&(this._boundUniforms[i]=n)}this._currentEffect=null}},{key:"_activateCurrentTexture",value:function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}},{key:"_bindTextureDirectly",value:function(e,t){var r,i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=!1,u=t&&t._associatedChannel>-1;n&&u&&(this._activeChannel=t._associatedChannel);var l=this._boundTexturesCache[this._activeChannel];if(l!==t||s){if(this._activateCurrentTexture(),t&&t.isMultiview)throw console.error(e,t),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,null!==(i=null===(r=null==t?void 0:t._hardwareTexture)||void 0===r?void 0:r.underlyingResource)&&void 0!==i?i:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else n&&(a=!0,this._activateCurrentTexture());return u&&!n&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),a}},{key:"_bindTexture",value:function(e,t,r){if(void 0!==e){t&&(t._associatedChannel=e),this._activeChannel=e;var i=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(i,t)}}},{key:"unbindAllTextures",value:function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}},{key:"setTexture",value:function(e,t,r,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))}},{key:"_bindSamplerUniformToChannel",value:function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)}},{key:"_getTextureWrapMode",value:function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}},{key:"_setTexture",value:function(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;r=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!i&&r&&(r._associatedChannel=e);var s=!0;this._boundTexturesCache[e]===r&&(i||this._bindSamplerUniformToChannel(r._associatedChannel,e),s=!1),this._activeChannel=e;var a=this._getTextureTarget(r);if(s&&this._bindTextureDirectly(a,r,i),r&&!r.isMultiview){if(r.isCube&&r._cachedCoordinatesMode!==t.coordinatesMode){r._cachedCoordinatesMode=t.coordinatesMode;var u=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=u,t.wrapV=u}r._cachedWrapU!==t.wrapU&&(r._cachedWrapU=t.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),r)),r._cachedWrapV!==t.wrapV&&(r._cachedWrapV=t.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),r)),r.is3D&&r._cachedWrapR!==t.wrapR&&(r._cachedWrapR=t.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),r)),this._setAnisotropicLevel(a,r,t.anisotropicFilteringLevel)}return!0}},{key:"setTextureArray",value:function(e,t,r,i){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var n=0;n<r.length;n++){var s=r[n].getInternalTexture();s?(this._textureUnits[n]=e+n,s._associatedChannel=e+n):this._textureUnits[n]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var a=0;a<r.length;a++)this._setTexture(this._textureUnits[a],r[a],!0)}}},{key:"_setAnisotropicLevel",value:function(e,t,r){var i=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(r=1),i&&t._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=r)}},{key:"_setTextureParameterFloat",value:function(e,t,r,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,r)}},{key:"_setTextureParameterInteger",value:function(e,t,r,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,r)}},{key:"unbindAllAttributes",value:function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else for(var t=0,r=this._vertexAttribArraysEnabled.length;t<r;t++)t>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[t]||this.disableAttributeByIndex(t)}},{key:"releaseEffects",value:function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}}},{key:"dispose",value:function(){var e;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),null===(e=this.releaseComputeEffects)||void 0===e||e.call(this),this.unbindAllAttributes(),this._boundUniforms={},(0,E.CG)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,o.Q.ResetCache();var t,r=B(this._activeRequests);try{for(r.s();!(t=r.n()).done;){t.value.abort()}}catch(i){r.e(i)}finally{r.f()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}},{key:"attachContextLostEvent",value:function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)}},{key:"attachContextRestoredEvent",value:function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)}},{key:"getError",value:function(){return this._gl.getError()}},{key:"_canRenderToFloatFramebuffer",value:function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}},{key:"_canRenderToHalfFloatFramebuffer",value:function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}},{key:"_canRenderToFramebuffer",value:function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var s=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&s===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var a=t.RGBA,u=t.UNSIGNED_BYTE,l=new Uint8Array(4);t.readPixels(0,0,1,1,a,u,l),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r}},{key:"_getWebGLTextureType",value:function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}},{key:"_getInternalFormat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:r=this._gl.ALPHA;break;case 1:r=this._gl.LUMINANCE;break;case 2:r=this._gl.LUMINANCE_ALPHA;break;case 6:r=this._gl.RED;break;case 7:r=this._gl.RG;break;case 4:r=t?this._gl.SRGB:this._gl.RGB;break;case 5:r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:r=this._gl.RED_INTEGER;break;case 9:r=this._gl.RG_INTEGER;break;case 10:r=this._gl.RGB_INTEGER;break;case 11:r=this._gl.RGBA_INTEGER}return r}},{key:"_getRGBABufferInternalSizedFormat",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return r?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return r?this._gl.SRGB8:this._gl.RGB8;case 5:return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8}},{key:"_getRGBAMultiSampleBufferFormat",value:function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8}},{key:"_loadFile",value:function(t,r,i,n,s,a){var u=this,l=e._FileToolsLoadFile(t,r,i,n,s,a);return this._activeRequests.push(l),l.onCompleteObservable.add((function(e){u._activeRequests.splice(u._activeRequests.indexOf(e),1)})),l}},{key:"readPixels",value:function(e,t,r,i){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=n?4:3,u=n?this._gl.RGBA:this._gl.RGB,l=new Uint8Array(i*r*a);return s&&this.flushFramebuffer(),this._gl.readPixels(e,t,r,i,u,this._gl.UNSIGNED_BYTE,l),Promise.resolve(l)}},{key:"getHostDocument",value:function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,E.n5)()?document:null}}],[{key:"NpmPackage",get:function(){return"babylonjs@5.42.0"}},{key:"Version",get:function(){return"5.42.0"}},{key:"ShadersRepository",get:function(){return o.Q.ShadersRepository},set:function(e){o.Q.ShadersRepository=e}},{key:"_CreateCanvas",value:function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var r=document.createElement("canvas");return r.width=e,r.height=t,r}},{key:"_ConcatenateShader",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return r+(t?t+"\n":"")+e}},{key:"_FileToolsLoadImage",value:function(e,t,r,i,n,s){throw(0,_.S)("FileTools")}},{key:"_FileToolsLoadFile",value:function(e,t,r,i,n,s){throw(0,_.S)("FileTools")}},{key:"IsSupportedAsync",get:function(){return Promise.resolve(this.isSupported())}},{key:"IsSupported",get:function(){return this.isSupported()}},{key:"isSupported",value:function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(r){this._IsSupported=!1}return this._IsSupported}},{key:"HasMajorPerformanceCaveat",get:function(){if(null===this._HasMajorPerformanceCaveat)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(r){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}},{key:"CeilingPOT",value:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},{key:"FloorPOT",value:function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)}},{key:"NearestPOT",value:function(t){var r=e.CeilingPOT(t),i=e.FloorPOT(t);return r-t>t-i?i:r}},{key:"GetExponentOfTwo",value:function(t,r){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;switch(n){case 1:i=e.FloorPOT(t);break;case 2:i=e.NearestPOT(t);break;default:i=e.CeilingPOT(t)}return Math.min(i,r)}},{key:"QueueNewFrame",value:function(e,t){if((0,E.CG)()){var r=t||window,i=r.requestPostAnimationFrame,n=r.requestAnimationFrame;if("function"==typeof i)return i(e);if("function"==typeof n)return n(e)}else if("function"==typeof requestAnimationFrame)return requestAnimationFrame(e);return setTimeout(e,16)}}]),e}();I.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],I._TextureLoaders=[],I.CollisionsEpsilon=.001,I._IsSupported=null,I._HasMajorPerformanceCaveat=null}}]);
//# sourceMappingURL=3a1a7810-4497fe7bcdd02ae6bb0a.js.map